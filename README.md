# Product Matching System for NTUST Big Data Analysis Course (EE5327701)

This repository contains a collection of scripts for finding top sellers on Ruten, searching items by sellers, and matching products between two datasets using a semantic model. It is designed as a demonstration for the **NTUST Big Data Analysis course (EE5327701)**.

## Features

- **Top Sellers Identification:** Finds top sellers for a given set of queries.
- **Item Search by Sellers:** Retrieves items sold by top sellers for specific queries.
- **Product Matching:** Matches products between two CSV files using a pre-trained semantic model and cosine similarity.

See `example_output/` for sample output files generated by the scripts. Note that the `matched_products.csv` file is generated by using following command:
```bash
python match.py output/search_results_by_sellers/LED燈泡_angela7817.csv output/search_results_by_sellers/LED燈泡_qiliang2017.csv
```
Which is specifically for the query "LED燈泡" and the top sellers "angela7817" and "qiliang2017".

## Table of Contents

- [Installation](#installation)
- [Setup](#setup)
- [Usage](#usage)
  - [1. Find Top Sellers](#1-find-top-sellers)
  - [2. Search Items by Sellers](#2-search-items-by-sellers)
  - [3. Product Matching](#3-product-matching)
- [Command-line Arguments](#command-line-arguments)
- [Notes](#notes)

## Installation

1. **Clone the repository:**
   ```bash
   git clone https://github.com/agbld/product-match-for-EE5327701.git
   cd product-match-for-EE5327701
   ```

2. (Optional) **Create a Conda environment with Python 3.8:**
   ```bash
   conda create --name bigdata-hw7 python=3.8
   conda activate bigdata-hw7
   ```
   Python 3.8 is recommended for compatibility with this project but you can try other versions as well.

3. **Install `ruten_api` module:**
   ```bash
   pip install git+https://github.com/agbld/ruten-api.git
   ```
   This is a custom module made by [agbld](https://github.com/agbld). For more details, please visit [agbld/ruten-api](https://github.com/agbld/ruten-api.git)

4. **Install required packages:**
   ```bash
   pip install -r requirements.txt
   ```

## Setup

Before running the scripts, ensure that:

1. **Queries File:** You have a `queries.txt` file in the root directory containing the queries to search for. Each query should be on a separate line.

## Usage

### 1. Find Top Sellers

The `find_top_sellers.py` script finds the top sellers for each query specified in `queries.txt`.

**Run the script:**

```bash
python find_top_sellers.py
```

**What it does:**

- Loads queries from `queries.txt`.
- Searches for each query using the `ruten_api`.
- Identifies top sellers based on the number of items they have listed.
- Saves the top sellers for each query to CSV files in `output/top_sellers/`.

**Parameters to Adjust:**

- `num_sellers`: Number of top sellers to find for each query (default is `2`).
- `top_k`: Number of items to retrieve for each query when searching (default is `200`).

To modify these parameters, edit the `find_top_sellers.py` script:

```python
num_sellers = 2  # Number of sellers to find for each query
top_k = 200      # Number of items to use for identifying top sellers
```

### 2. Search Items by Sellers

The `search_by_sellers.py` script searches for items sold by the top sellers identified in the previous step.

**Run the script:**

```bash
python search_by_sellers.py
```

**What it does:**

- Loads the top sellers data from `output/top_sellers/`.
- For each query and its top sellers, searches for items sold by these sellers using the `ruten_api`.
- Saves the search results to CSV files in `output/search_results_by_sellers/`.

**Parameters to Adjust:**

- `top_k`: Number of items to retrieve for each seller (default is `40`).

To modify this parameter, edit the `search_by_sellers.py` script where `top_k` is specified in the `ruten_api.search()` call.

### 3. Product Matching

The `match.py` script matches products between two CSV files using a semantic model.

**Run the script:**

```bash
python match.py path/to/csv_file1.csv path/to/csv_file2.csv --threshold 0.9
```

**Command-line Arguments:**
For the `match.py` script, the following command-line arguments are accepted:

| Argument      | Type    | Default | Description                                                          |
|---------------|---------|---------|----------------------------------------------------------------------|
| `csv_file1`   | `str`   |         | Path to the first CSV file containing products to match.             |
| `csv_file2`   | `str`   |         | Path to the second CSV file containing products to match against.    |
| `--threshold` | `float` | `0.9`   | Similarity threshold for matching products (e.g., `0.9`).            |

**What it does:**

- Loads the two CSV files.
- Loads a pre-trained semantic model.
- Computes embeddings for the product names (`name` column) in both files.
- Calculates cosine similarity between the embeddings of products from both files.
- Finds the best matches above the specified threshold.
- Saves the matched and unmatched products to `output/matched_products.csv`.

**Example Usage:**

```bash
python match.py output/search_results_by_sellers/LED燈泡_angela7817.csv output/search_results_by_sellers/LED燈泡_qiliang2017.csv --threshold 0.85
```

## Notes

- **Semantic Model:** The scripts use a pre-trained semantic model `clw8998/semantic_model-for-EE5327701`. Ensure you have access to this model on the Hugging Face Hub or replace it with your own.

- **`ruten_api` Module:** The scripts rely on a module named `ruten_api` for searching and retrieving data from Ruten. Please install this module before running the scripts.

---

This repository is created for academic purposes as part of the NTUST Big Data Analysis course (EE5327701). Feel free to modify and extend it for other projects!